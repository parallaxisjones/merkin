/*
 merkin.js 2015-08-02 
*/
String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),function(a){function b(a,b){if(!a)throw new TypeError("you need to defined a macro");this.macro=a,this.thing=b}function c(){}function d(a){this.config=a?a:{},this.config.index=0,f.extend(this,a)}function e(a){this.options={},f.extend(this.options,a)}var f=function(a){var b=a?a:{},c=f.extend(jQuery,this,b);return c.call(b,arguments[0],arguments[1])};f.prototype=Object.prototype,f.prototype.map=function(a){if("function"!=typeof a)throw new TypeError;for(var b=new Array(d),c=arguments[1],d=c.length,e=0;d>e;e++)e in c&&(b[e]=a.call(c,c[e],e,c));return b},f.prototype.extend=function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]},f.prototype.actionFilter=function(a,b){return a&&b&&"function"==typeof b?b.apply(a,arguments):void 0},f.prototype.createMacro=function(a,b){if(!a)throw new TypeError;return function(c){return c===a&&"function"==typeof b?b():c===a?b:void 0}},b.prototype.get=function(a){return a===this.macro&&"function"==typeof this.thing?this.thing():a===this.macro?this.thing:void 0},b.prototype.check=function(a){var b=a.match(/{{\s*[\w\.]+\s*}}/g);if(null!==b){var c=b.map(function(a){return console.log(a.match(/[\w\.]+/)),a.match(/[\w\.]+/)[0]})[0];if(c===this.macro)return!0}return!1},b.prototype.run=function(a){var b=a.match(/{{\s*[\w\.]+\s*}}/g);if(null!==b){var c=b.map(function(a){return console.log(a.match(/[\w\.]+/)),a.match(/[\w\.]+/)[0]})[0];a=a.replace(/{{\s*[\w\.]+\s*}}/g,this.get(c))}return a},c.prototype.isClass=function(a){return-1==a.indexOf(".")&&(a="."+a),a},d.prototype={config:{tags:[],html:"",index:0}},d.prototype.setTags=function(a,b){var c=f.map(function(a,c){return a.format.apply(a,b),a},a);this.config.tags=c,this.config.html=a.join("")},d.prototype.appendNew=function(a,b,c){a=a?f.extend({},a,this.config):{},b&&"function"==typeof b&&(this.config.html=this.applyTagFilters(a,b)),f("dl").each(function(a){$(a).removeClass("active")}),f(this.config.parent).append(this.config.html),this.config.index++,c&&"function"==typeof c&&(console.log(f("."+this.config.child+":last-child")),c.apply({element:f("."+this.config.child+":last-child")},arguments))},d.prototype.removeLastChild=function(a,b,c){a=a?f.extend({},a,this.config):{},b&&"function"==typeof b&&(this.config.html=this.applyTagFilters(a,b));var d="."+this.config.child;console.log(d),$(d).each(function(a,b){if($(b).hasClass("active")){var c=$(b).prev();$(b).remove(),c.addClass("active")}}),this.config.index--,c&&"function"==typeof c&&c.apply(this,arguments)},d.prototype.clearAll=function(a,b){a&&"function"==typeof a&&this.applyTagFilters(a),$(this.parent).remove(this.classes),b&&"function"==typeof a&&this.applyTagFilters(a)},d.prototype.applyTagFilters=function(a,b){var c={};a&&f.extend(c,a);if(c.tags&&c.tags.length>0){var d=f.map(function(a,c){return f.actionFilter(a,b)},a.tags);a.html=d.join("")}return a.html},e.prototype.remove=function(){var a="."+this.options["class"];$(this.options.parent).find(".active").remove(),$("body").find(a).remove()},e.prototype.add=function(){var a="."+this.options.elementClass,b="."+this.options["class"],c=($(a),$(b),document.createElement("img"));c.src=this.options.src,c.height=this.options.height,c.width=this.options.width,$(c).addClass(this.options["class"]),c.onclick=this.options.enact,$(".query-params:last-child").addClass("active"),$("dl.active dd").append(c)},f.Template=d,f.Control=e,f.Ensure=c,f.Macro=b,a.Merkin=f}(window);